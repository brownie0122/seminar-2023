# S3 & Cloudfront 배포 가이드

## 1. AWS 가입

알아서 하시구요

## 2. S3 버킷 생성

S3라는 서비스에서는 버킷을 단위로 하여 파일 더미를 저장할 수 있습니다.

그 버킷이란 걸 만들어봅시다. 건드려야 할 부분은:

- 이름: 맘대로 지으세요

일단 그렇게 생성하고, 이따 돌아와서 몇 가지 수정할 겁니다.

## 3. Cloudfront 배포 생성

Cloudfront라는 서비스에서는 배포를 단위로 음... 배포합니다.

배포를 생성할 건데, 건드려야 할 부분은:

- 원본 도메인: 방금 생성한 S3 버킷 주소가 자동완성될 건데, 그걸 선택합니다. ex) `mybucketname.s3.ap-northeast-2.amazonaws.com`
- 원본 액세스: "원본 액세스 제어 설정"으로 설정합니다.
  - Origin access control: "제어 설정 생성"을 통해 만들어 설정합니다. 제어 설정을 만들면서 건드릴 건 따로 없습니다.
  - "S3 버킷 정책을 업데이트해야 함"이라는 메시지가 뜰 겁니다. 이따 업데이트할 거니까 제쳐둡니다.
- 기본값 루트 객체: `index.html`로 설정합니다. 요청한 경로가 폴더일 때 받을 파일입니다.

## 4. S3 버킷 권한 설정

방금 생성한 Cloudfront 배포 설정에서 "원본" 탭에 가면 방금 설정한 S3 원본이 있습니다. 이 원본을 선택하여 "편집"합니다.

사실 편집은 안 합니다. "버킷 정책"에서 "정책 복사" 버튼을 누릅니다. JSON 형식의 텍스트가 클립보드에 복사됩니다.

아까 만든 S3 버킷 설정으로 이동합니다. "권한" 탭의 "버킷 정책" 칸을 "편집"하여 방금 복사했던 정책을 붙여넣습니다. 붙여넣고 "변경 사항 저장"했을 때 아무 오류도 없다면 성공!

## 5. 파일 업로드

제일 어려운 부분은 끝났습니다. 그 뒤에는 IAM이라는 서비스에서 권한이 제한된 새끼(sub) 계정을 만들고 AWS CLI를 설치하여 잘 설정하면 나중에 명령어를 입력하여 배포할 수 있습니다.

아님 AWS 콘솔 웹페이지에서 업로드할 수도 있겠죠? 실수로 소스코드가 포함되거나 이상한 폴더 구조가 올라가더라도 몰라요~

강의 슬라이드에서 알려드린 [링크](https://react-etc.vlpt.us/08.deploy-s3.html)에서 IAM 및 CLI 설정은 잘 설명되어있고 지금과 많이 다른 부분도 없을테니 참고하세요.
